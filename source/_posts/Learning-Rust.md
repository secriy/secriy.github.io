---
title: "Learning Rust"
date: 2021-09-18 14:25:28
urlname: learning-rust
categories: å­¦ä¹ ç¬”è®°
tags:
  - Rust
  - PL
references:
  - title: The Rust Programming Language
    url: https://doc.rust-lang.org/book/
mathjax: true
---

{% noteblock quote cyan %}

æœ¬æ–‡ä¸»è¦æ ¹æ® [The Rust Programming Language](https://doc.rust-lang.org/book/) ç¿»è¯‘æ€»ç»“è€Œæˆï¼Œå¤§å¤šå†…å®¹çº¯ç²¹æ˜¯å¯¹è¯¥ä¹¦çš„ç¿»è¯‘ï¼Œä½†æŒ‰ç…§æˆ‘ä¸ªäººçš„å­¦ä¹ è·¯çº¿ä»¥åŠç»ƒä¹ å¢åˆ äº†ä¸€äº›å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿå‚è€ƒäº†å…¶ä»–æ–‡æ¡£å¯¹éœ€è¦æ·±å…¥è®¨è®ºæˆ–æ˜¯éš¾ä»¥ç†è§£çš„éƒ¨åˆ†è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼Œ**å› æ­¤å¯¹äºæœ¬æ–‡å†…å®¹è¯·ä¸è¦è®¤ä¸ºå…¶ç­‰åŒäºåŸæ–‡**ã€‚æœ¬æ–‡å¯¹äºæœ‰å…¶ä»–ç¼–ç¨‹è¯­è¨€ç»éªŒçš„åŒå­¦æ¥è¯´æ¯”è¾ƒå®¹æ˜“æ¥å—ï¼Œå®¹æ˜“å¼•èµ·æ­§ä¹‰çš„è‹±æ–‡ç¿»è¯‘éƒ½ä¼šæ ‡æ³¨åŸæ–‡ã€‚ç”±äºæœ¬æ–‡å®Œå…¨ç›´æ¥å‚è€ƒå®˜æ–¹æ•™ç¨‹ç­‰è‹±æ–‡æ–‡çŒ®ï¼Œå¯ä»¥ç¡®ä¿å†…å®¹ä¸å­˜åœ¨ç”±äºè½¬ç»å¤šäººä¹‹æ‰‹è€Œå‡ºç°çš„åå·®ã€‚ä½†å—é™äºä¸ªäººçŸ¥è¯†æ°´å¹³ï¼Œéš¾å…å‡ºç°ç–æ¼é”™è¯¯ï¼Œçƒ¦è¯·å‘ŠçŸ¥ã€‚

{% endnoteblock %}

<!-- more -->

## åŸºç¡€æ¦‚å¿µ

> æœ¬ç« æ²¡æœ‰ä»€ä¹ˆéš¾åº¦ï¼Œä¸»è¦æ˜¯å¯¹ Rust åŸºç¡€æ¦‚å¿µå’Œç”¨æ³•çš„å­¦ä¹ å’Œé€‚åº”ï¼Œæ— éœ€å¼ºè¡Œè®°å¿†ï¼Œéœ€è¦æ—¶å‚è€ƒå³å¯ï¼Œå¾ˆå¿«èƒ½å¤Ÿç†Ÿç»ƒæŒæ¡ã€‚

### å˜é‡å’Œå¯å˜æ€§

#### å˜é‡

Rust ä¸­å˜é‡æœ‰å¯å˜å˜é‡ï¼ˆ*mutable variable*ï¼‰å’Œä¸å¯å˜å˜é‡ï¼ˆ*immutable variable*ï¼‰çš„åŒºåˆ†ï¼Œçœ‹å¦‚ä¸‹çš„ä»£ç ï¼š

```rust
fn main() {
    let x = 5;
    println!("{}", x);
    x = 6;
    println!("{}", x);
}
```

ä½¿ç”¨ `cargo run` è¿è¡Œï¼š

```shell
$ cargo run
   Compiling hello-rust v0.1.0
error[E0384]: cannot assign twice to immutable variable `x`
 --> src\main.rs:4:5
  |
2 |     let x = 5;
  |         -
  |         |
  |         first assignment to `x`
  |         help: consider making this binding mutable: `mut x`
3 |     println!("{}", x); // 5
4 |     x = 6;
  |     ^^^^^ cannot assign twice to immutable variable

error: aborting due to previous error

For more information about this error, try `rustc --explain E0384`.
error: could not compile `hello-rust`

To learn more, run the command again with --verbose.
```

ä¸Šé¢çš„é”™è¯¯è¡¨æ˜ï¼Œå˜é‡ `x` æ— æ³•äºŒæ¬¡èµ‹å€¼ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª *immutable variable*ã€‚å¦å¤–æŠ¥é”™è¿˜è¯´æ˜ï¼ŒRust åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»å¯¹ç¨‹åºå¯èƒ½å‡ºç°çš„æŸäº›é—®é¢˜ä½œäº†åˆ¤æ–­ï¼Œå¦‚æœä¸é€šè¿‡æ£€æŸ¥åˆ™ç¼–è¯‘å¤±è´¥ã€‚

```rust
fn main() {
    let mut x = 5;
    println!("{}", x); // 5
    x = 6;
    println!("{}", x); // 6
}
```

é€šè¿‡ `let mut x = 5` çš„æ–¹å¼å°† `x` åˆå§‹åŒ–ä¸ºå¯å˜å˜é‡ã€‚

#### å¸¸é‡

å¸¸é‡çš„å£°æ˜ä½¿ç”¨å¦‚ä¸‹å½¢å¼çš„è¯­å¥ï¼š

```rust
// const [NAME]: [DATA_TYPE] = [DATA];
const PI: f32 = 3.14159;
```

#### å·®åˆ«

å¸¸é‡å’Œå˜é‡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ

1. å¸¸é‡æ— æ³•ä½¿ç”¨ `mut` ä¿®é¥°ï¼Œå®ƒå§‹ç»ˆæ˜¯ä¸å¯å˜çš„ï¼›
2. å¸¸é‡ä½¿ç”¨ `const` å£°æ˜ï¼Œå˜é‡ä½¿ç”¨ `let`ï¼›
3. å¸¸é‡å¿…é¡»å§‹ç»ˆæ³¨æ˜å…¶æ•°æ®ç±»å‹ï¼›
4. å¸¸é‡å¯ä»¥åœ¨ä»»ä½•èŒƒå›´å£°æ˜ï¼Œå¦‚å…¨å±€å¸¸é‡ã€å±€éƒ¨å¸¸é‡ï¼›
5. å¸¸é‡æ˜¯é€šè¿‡å¸¸é‡è¡¨è¾¾å¼ç¡®å®šå€¼çš„ï¼Œåœ¨ç¼–è¯‘æœŸå…¶å€¼å°±ä¼šè¢«ç¡®å®šï¼Œè€Œå˜é‡çš„å€¼å¯ä»¥åœ¨è¿è¡Œæ—¶èµ‹äºˆã€‚

#### Shadowing

Rust æ”¯æŒä½¿ç”¨ `let` å…³é”®å­—è¿›è¡ŒåŒåå˜é‡çš„é‡å¤åˆå§‹åŒ–ï¼š

```rust
fn main() {
    let x = 5;

    let x = x + 1;

    let x = x * 2;

    println!("The value of x is: {}", x); // The value of x is: 12
}
```

ç”šè‡³å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªä¸åŒç±»å‹çš„åŒåå˜é‡ï¼š

```rust
fn main() {
    let string = "abc";

    let string = string.len();

    println!("The length of string is: {}", string) // The length of string is: 3
}
```

ç¬¬ä¸€ä¸ª `string` å’Œç¬¬äºŒä¸ª `string` å¹¶éåŒä¸€ä¸ªå˜é‡ï¼Œå®ƒä»¬åªæ˜¯åŒåï¼Œä¸åŒäº `mut` å˜é‡ï¼Œå…¶ä¸¤ä¸ªåŒåå˜é‡ä¹‹é—´æ˜¯æ²¡æœ‰å…³è”çš„ã€‚æŒ‰ Rust å®˜æ–¹çš„è¯´æ³•ï¼Œç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ªå˜é‡é®è”½ï¼ˆ*shadowed*ï¼‰äº†ï¼Œå› æ­¤è¿™ä¸ªæ¦‚å¿µåœ¨ Rust ä¸­å«åš *Shadowing*ã€‚

å¦‚æœå¯¹ `mut` å˜é‡èµ‹æ–°å€¼ï¼š

```rust
fn main() {
    let mut string = "abc";

    string = string.len();

    println!("The length of string is: {}", string)
}
```

ä¸Šé¢çš„ä»£ç åœ¨ç¼–è¯‘æ—¶å°±æ— æ³•é€šè¿‡ï¼Œå› ä¸ºå…¶ç±»å‹ä¸åŒ¹é…ã€‚

çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼Œå¯¹ `mut` å˜é‡è¿›è¡Œäº†é‡æ–°èµ‹å€¼ï¼š

```rust
fn main() {
    let mut string = "abc";

    string = "xyz";

    println!("The string is: {}", string) // The string is: xyz
}
```

è¿™æ®µä»£ç èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ç¼–è¯‘æœŸé—´ä¼šè¾“å‡º `warning`ï¼Œå³è­¦å‘Šä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸º `"abc"` å­—ç¬¦ä¸²å¹¶æ²¡æœ‰ä½¿ç”¨å°±è¢« `"xyz"` è¦†ç›–äº†ï¼Œæ‰€ä»¥å‡ºç°è­¦å‘Šï¼Œä½†è¿™å¹¶ä¸å½±å“ç¨‹åºçš„è¿è¡Œã€‚

### æ•°æ®ç±»å‹

æ•°æ®ç±»å‹æ˜¯é™æ€ç±»å‹ç›¸å½“é‡è¦çš„éƒ¨åˆ†ï¼ŒRust ä½œä¸ºä¸€ç§é™æ€ç±»å‹è¯­è¨€ï¼Œå…¶æ¯ä¸€ä¸ªå€¼éƒ½æœ‰æŒ‡å®šçš„ç±»å‹ï¼Œæ‰€æœ‰å˜é‡çš„ç±»å‹åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†ã€‚

Rust ä¸­æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ ‡é‡ç±»å‹ï¼ˆscalarï¼‰ä»¥åŠå¤åˆç±»å‹ï¼ˆcompoundï¼‰ã€‚

#### æ ‡é‡ç±»å‹

æ ‡é‡ç±»å‹æ˜¯ç®€å•ç±»å‹ï¼Œä»£è¡¨äº†å•ä¸ªå€¼ã€‚Rust ä¸­æœ‰å››ç§æ ‡é‡ç±»å‹ï¼š

- æ•´æ•°
- æµ®ç‚¹æ•°
- å¸ƒå°”å€¼
- å­—ç¬¦

##### æ•´æ•°

Rust ä¸­çš„æ•´æ•°ç±»å‹å¦‚ä¸‹è¡¨ï¼š

| é•¿åº¦ï¼ˆLengthï¼‰ | æœ‰ç¬¦å·ï¼ˆSignedï¼‰ | æ— ç¬¦å·ï¼ˆUnsignedï¼‰ |
| :------------: | :--------------: | :----------------: |
|     8-bit      |        i8        |         u8         |
|     16-bit     |       i16        |        u16         |
|     32-bit     |       i32        |        u32         |
|     64-bit     |       i64        |        u64         |
|    128-bit     |       i128       |        u128        |
|      arch      |      isize       |       usize        |

`arch` å³ architectureï¼Œè¡¨ç¤º CPU æ¶æ„çš„ä½æ•°ï¼Œå¦‚ 64-bit æœºå™¨ä¸Šå°±æ˜¯ 64 bitsï¼Œ32-bit æœºå™¨ä¸Šå°±æ˜¯ 32 bitsï¼Œè¿™åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€é‡Œä¹Ÿå¾ˆå¸¸è§ï¼Œå¦‚ C ä¸­çš„`int`ç±»å‹ã€‚

æ•´æ•°ç±»å‹çš„å­—é¢é‡è¡¨ç¤ºå¦‚ä¸‹è¡¨ï¼š

| å­—é¢é‡ï¼ˆNumber literalsï¼‰ |    ç¤ºä¾‹     |
| :-----------------------: | :---------: |
|      åå…­è¿›åˆ¶ï¼ˆHexï¼‰      |    0xff     |
|     åè¿›åˆ¶ï¼ˆDecimalï¼‰     |   98_222    |
|      å…«è¿›åˆ¶ï¼ˆOctalï¼‰      |    0o77     |
|     äºŒè¿›åˆ¶ï¼ˆBinaryï¼‰      | 0b1111_0000 |
| å­—èŠ‚ï¼ˆByteï¼Œä»…æ”¯æŒ `u8`ï¼‰ |    b'A'     |

Rust é»˜è®¤ä½¿ç”¨ `i32` åˆå§‹åŒ–æ•´æ•°ã€‚

##### æµ®ç‚¹æ•°

Rust ä¸­æœ‰ `f32` å’Œ `f64` ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹ï¼Œåˆ†åˆ«å ç”¨ 32 bits å’Œ 64 bits çš„å¤§å°ã€‚Rust ä½¿ç”¨ `f64` ä½œä¸ºæµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç°ä»£ CPU ä¸­ï¼Œ64 ä½æµ®ç‚¹æ•°çš„è¿ç®—é€Ÿåº¦å’Œ 32 ä½åŸºæœ¬ç›¸åŒï¼Œä½† 64 ä½æµ®ç‚¹æ•°ç²¾åº¦æ›´é«˜ã€‚

ç¤ºä¾‹ï¼š

```rust
let x = 1.0;  // f64
let y: f32 = 3.0; // f32
```

æŒ‰ç…§ IEEE-754 æ ‡å‡†ï¼Œ`f32` ä¸ºå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œ`f64` ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚

##### æ•°å€¼è¿ç®—

ç¤ºä¾‹ï¼š

```rust
fn main() {
    // åŠ æ³• addition
    let sum = 5 + 10;

    // å‡æ³• subtraction
    let difference = 95.5 - 4.3;

    // ä¹˜æ³• multiplication
    let product = 4 * 30;

    // é™¤æ³• division
    let quotient = 56.7 / 32.2;

    // å–ä½™ remainder
    let remainder = 43 % 5;
}
```

##### å¸ƒå°”å€¼

å¸ƒå°”å€¼çš„å¤§å°ä¸º 1 byteï¼Œæœ‰ `true` å’Œ `false` è¿™ä¸¤ä¸ªå¯èƒ½çš„å€¼ã€‚

ç¤ºä¾‹ï¼š

```rust
let t = true;
let f: bool = false; // æ˜¾å¼æŒ‡å®šç±»å‹
```

##### å­—ç¬¦ç±»å‹

Rust ä¸­å­—ç¬¦ç±»å‹ï¼ˆ`char`ï¼‰ä½¿ç”¨å•å¼•å·å­—é¢é‡ï¼Œç”¨äºå­˜å‚¨å•ä¸ªå­—ç¬¦ã€‚Rust çš„ `char` ç±»å‹åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„å¤§å°ä¸º 4 bytesï¼Œè¡¨ç¤ºä¸€ä¸ª Unicode æ ‡é‡å€¼ã€‚

ç¤ºä¾‹ï¼š

```rust
let c = 'z';
let z = 'â„¤';
let æ±‰ = 'å¥½';
let heart_eyed_cat = 'ğŸ˜»';
```

å¯ä»¥æ³¨æ„åˆ°ï¼ŒRust æ˜¯æ”¯æŒéè‹±æ–‡å˜é‡åçš„ã€‚

#### å¤åˆç±»å‹

å¤åˆç±»å‹æ˜¯ç”±å¤šä¸ªæ•°æ®ç±»å‹ç»„åˆæˆçš„ä¸€ç§æ•°æ®ç±»å‹ï¼ŒRust æœ‰ä¸¤ç§åŸå§‹çš„å¤åˆç±»å‹ï¼šTupleï¼ˆå…ƒç»„ï¼‰å’Œ Arrayï¼ˆæ•°ç»„ï¼‰ã€‚

##### Tuple

Tuple çš„å¤§å°å›ºå®šï¼Œä¸€æ—¦è¢«å£°æ˜ï¼Œå…¶å¤§å°å°±ä¸å¯ä¿®æ”¹ã€‚

åˆ›å»º Tupleï¼š

```rust
fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);
}
```

ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªç”± `i32`ï¼Œ`f64` å’Œ `u8` ä¸‰ä¸ªç±»å‹ç»„æˆçš„ Tuple `tup`ï¼Œå¹¶åˆå§‹åŒ–å…¶å€¼ã€‚

ä» Tuple å–å€¼ï¼š

```rust
fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);

    let (x, y, z) = tup;

    println!("The value of x is: {}", x); // The value of x is: 500
    println!("The value of y is: {}", y); // The value of y is: 6.4
    println!("The value of z is: {}", z); // The value of z is: 1
}
```

ç±»ä¼¼ `let (x, y, z) = tup` å°†ä¸€ä¸ª tuple èµ‹å€¼ç»™å¤šä¸ªå˜é‡çš„ç”¨æ³•è¢«ç§°ä¸ºè§£æ„ï¼ˆ*destructuring*ï¼‰ï¼Œ

è¿˜å¯ä»¥ç›´æ¥æ ¹æ®ä¸‹æ ‡å–å€¼ï¼š

```rust
fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);

    println!("The value of x is: {}", tup.0); // The value of x is: 500
    println!("The value of y is: {}", tup.1); // The value of y is: 6.4
    println!("The value of z is: {}", tup.2); // The value of z is: 1
}
```

##### Array

Array å’Œ Tuple çš„å·®åˆ«å¾ˆå¤§ï¼Œå‰è€…åªèƒ½åŒ…å«ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ ï¼Œåè€…åˆ™ä¸ç„¶ã€‚ä¸è¿‡ Rust ä¸­çš„ Array å’Œ Tuple ä¸€æ ·æ˜¯å›ºå®šé•¿åº¦çš„ï¼Œä¸å¯æ”¹å˜ã€‚

Array çš„åˆå§‹åŒ–ï¼š

```rust
fn main() {
    let a = [1, 2, 3, 4, 5]; // åˆå§‹åŒ–
    let b: [i32; 5] = [1, 2, 3, 4, 5]; // [type; length]
}
```

Array ç‰¹æ®Šåœ¨äºå…¶ä¸€èˆ¬åˆ†é…åœ¨å†…å­˜ç©ºé—´ä¸­çš„æ ˆï¼ˆstackï¼‰ä¸Šè€Œä¸æ˜¯å †ï¼ˆheapï¼‰ä¸Šï¼Œè¿™åœ¨åæ–‡ä¼šæ·±å…¥è®¨è®ºã€‚å½“éœ€è¦å›ºå®šé•¿åº¦çš„ä¸€ç³»åˆ—å…ƒç´ æ—¶ï¼Œç”¨ Array ä¼šæ¯”è¾ƒåˆé€‚ã€‚Rust ä¸­è¿˜æœ‰ä¸€ç§å¯å˜çš„æ•°ç»„ï¼Œå³ **vector**ï¼Œä½†å®ƒæ˜¯ç”±æ ‡å‡†åº“æä¾›çš„è€Œä¸æ˜¯ Rust è¯­è¨€æœ¬èº«ï¼Œä¸€èˆ¬æ¥è¯´ vector ä¼šæ›´å¸¸ç”¨ä¸€äº›ã€‚

Array çš„å£°æ˜å’Œå–å€¼ï¼š

å’Œå…¶ä»–å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ç›¸åŒï¼ŒRust ä¸­å–æ•°ç»„å…ƒç´ ä½¿ç”¨ä¸‹æ ‡ï¼Œå¦‚ `a[0]`ã€‚

```rust
fn main() {
 let a: [isize; 5]; // å£°æ˜é•¿åº¦ä¸º 5 çš„ç©ºæ•°ç»„
    println!("{}", a[0]);
}
```

ä¸Šé¢çš„ä»£ç ä¼šç›´æ¥ç¼–è¯‘ä¸é€šè¿‡ï¼ŒæŠ¥ ``use of possibly-uninitialized `a` `` é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸º Rust ç¦æ­¢ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡ï¼Œæ”¹æˆä¸‹é¢çš„ä»£ç å°±å¯ä»¥äº†ï¼š

```rust
fn main() {
    let a: [isize; 5];
    a = [3; 5]; // å°†ä¸€ä¸ªé•¿åº¦ä¸º 5ï¼Œå†…å®¹å…¨éƒ¨ä¸º 3 çš„æ•°ç»„èµ‹ç»™å˜é‡ a
    println!("{}", a[0]); // 3
}
```

`a = [3; 5]` ç­‰åŒäº `a = [3, 3, 3, 3, 3]`ã€‚

æˆ‘ä»¬æ³¨æ„åˆ°ä¸€ä»¶äº‹æƒ…ï¼šArray å˜é‡é»˜è®¤æ˜¯ *mutable* çš„ï¼Œä¸éœ€è¦ä½¿ç”¨ `mut` ä¿®é¥°å°±å¯ä»¥å¯¹å…¶é‡æ–°èµ‹å€¼ã€‚

å¦‚æœæˆ‘ä»¬è®¿é—®æ•°ç»„æ—¶è¶Šç•Œä¼šæ€ä¹ˆæ ·ï¼Ÿåœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­è¶Šç•Œå¹¶ä¸ä¼šé€ æˆç¨‹åºæœ¬èº«åœæ­¢æˆ–å¼‚å¸¸ï¼Œä½†ä¼šç»™å†…å­˜ä¸Šçš„æ•°æ®é€ æˆç ´åã€‚åœ¨ Rust ä¸­ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥æ•°ç»„è®¿é—®çš„ä¸‹æ ‡æ˜¯å¦è¶Šç•Œï¼Œå¦‚æœè¶Šç•Œåˆ™æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚å½“ä¸‹æ ‡çš„å€¼åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰ä¼šç¡®å®šï¼ˆå¦‚æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ä¸‹æ ‡å€¼ï¼‰æ—¶ï¼Œè¶Šç•Œä¼šå¯¼è‡´ç¨‹åº **panic**ï¼Œå¹¶éšä¹‹ä¸­æ­¢ã€‚

### å‡½æ•°

åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‡½æ•°éƒ½æ˜¯ç›¸å½“é‡è¦çš„å­˜åœ¨ï¼ŒRust ä¹Ÿä¸ä¾‹å¤–ï¼Œå‡½æ•°çš„ä½¿ç”¨æ— å¤„ä¸åœ¨ï¼Œæ¯”å¦‚å‰æ–‡ä¸­å¤§é‡ä½¿ç”¨çš„ `main` å‡½æ•°ã€‚

#### å‘½åè§„èŒƒ

Rust ä½¿ç”¨ `fn` å…³é”®å­—å£°æ˜å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ snake case å‘½åé£æ ¼ï¼Œæ‰€æœ‰çš„å‡½æ•°åä½¿ç”¨å°å†™å­—æ¯å¹¶ä½¿ç”¨ `_` åˆ†éš”ã€‚Rust å¹¶ä¸åœ¨ä¹å‡½æ•°çš„å®šä¹‰ä½ç½®ï¼Œæ— è®ºå…¶åœ¨ä»£ç ä¸­æ˜¯ä½äº `main` å‡½æ•°ä¹‹å‰è¿˜æ˜¯ä¹‹åã€‚

```rust
fn sample_func() {
    println!("Sample function.");
}

fn hello_world() {
    println!("Hello world.");
}
```

è°ƒç”¨å‡½æ•°ä¹Ÿå¾ˆç®€å•ï¼Œä¾‹å¦‚ `sample_func()`ï¼š

```rust
fn main() {
    hello_world(); // Hello world.
}

fn hello_world() {
    println!("Hello world.");
}
```

#### å‡½æ•°å‚æ•°

å‡½æ•°å‚æ•°ç”¨æ³•ï¼š

```rust
fn main() {
    another_function(5);
}

fn another_function(x: i32) {
    println!("The value of x is: {}", x); // The value of x is: 5
}
```

å¤šä¸ªå‚æ•°ï¼š

```rust
fn main() {
    another_function(5, 6);
}

fn another_function(x: i32, y: i32) {
    println!("The value of x is: {}", x); // The value of x is: 5
    println!("The value of y is: {}", y); // The value of y is: 6
}
```

å‡½æ•°çš„æ¯ä¸ªå‚æ•°éƒ½å¿…é¡»æŒ‡æ˜å…¶ç±»å‹ã€‚

#### å‡½æ•°è¿”å›å€¼

å‡½æ•°å¯ä»¥å‘è°ƒç”¨å®ƒä»¬çš„ä»£ç è¿”å›å€¼ã€‚æˆ‘ä»¬ä¸å‘½åè¿”å›å€¼ï¼Œä½†åœ¨ç®­å¤´ï¼ˆ`->`ï¼‰åé¢å£°æ˜å®ƒä»¬çš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¸å‡½æ•°ä½“å—ä¸­æœ€ç»ˆè¡¨è¾¾å¼çš„å€¼åŒä¹‰ã€‚é€šè¿‡ä½¿ç”¨ return å…³é”®å­—å¹¶æŒ‡å®šå€¼ï¼Œå¯ä»¥æå‰ä»å‡½æ•°è¿”å›ï¼Œä½†å¤§å¤šæ•°å‡½æ•°éšå¼è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¿”å›å€¼çš„å‡½æ•°ç¤ºä¾‹ï¼š

Rust ä¸­å‡½æ•°è¿”å›å€¼æ˜¯æ— åçš„ï¼Œåªéœ€è¦æŒ‡å®šå…¶ç±»å‹ï¼š

```rust
fn five() -> i32 {
    5
}

fn plus_one(x: i32) -> i32 {
    x + 1
}

fn main() {
    let mut x = five();
    x = plus_one(x);

    println!("The value of x is: {}", x); // The value of x is: 6
}
```

æ³¨æ„ï¼Œä½œä¸ºå‡½æ•°è¿”å›å€¼çš„è¯­å¥ï¼Œå…¶åæ˜¯æ²¡æœ‰ `;` çš„ï¼Œå¦‚ä¸Šé¢çš„ `5` å’Œ `x + 1`ï¼ŒåŠ ä¸Šåˆ†å·å°±å˜æˆäº†æ™®é€šè¯­å¥ï¼Œè€Œä¸æ˜¯è¿”å›å€¼ã€‚

`plus_one` å‡½æ•°è¿˜å¯ä»¥æ”¹æˆå¦‚ä¸‹çš„å½¢å¼ï¼š

```rust
fn plus_one(mut x: i32) -> i32 {
    x = x + 1;
    x
}
```

è¿™å’ŒåŸæ¥çš„ `plus_one` å‡½æ•°æ˜¯ç­‰ä»·çš„ï¼Œåªä¸è¿‡ä½¿ç”¨äº† `mut` ä¿®é¥°ç¬¦è®© `x` å¯å˜ã€‚

### æ³¨é‡Š

æ³¨é‡Šå¾ˆç®€å•ï¼Œä¾‹å¦‚å•è¡Œæ³¨é‡Šï¼š

```rust
// This is a comment.
```

å¤šè¡Œæ³¨é‡Šï¼š

```rust
// Multiple lines
// comments.
```

```rust
fn main() {
    println!("Hello World!"); // Hello World!
}
```

Rust ä¸­è¿˜æœ‰ä¸€ç§æ–‡æ¡£æ³¨é‡Šï¼Œä½†æš‚æ—¶ç”¨ä¸åˆ°ï¼Œåœ¨ä¹‹åä¼šä»‹ç»ã€‚

### æ§åˆ¶æµ

æ§åˆ¶æµæ˜¯å¾ˆåŸºæœ¬çš„æ¦‚å¿µï¼ŒRust åŒæ ·åŒ…å«äº†å¤šç§åŸºæœ¬çš„æ§åˆ¶æµã€‚

#### æ¡ä»¶

Rust ä¸­ `if` è¯­å¥ä¸éœ€è¦ä½¿ç”¨æ‹¬å·ï¼š

```rust
fn main() {
    let number = 3;

    if number < 5 {
        println!("number < 5"); // number < 5
    } else {
        println!("number >= 5");
    }
}
```

åœ¨ Rust ä¸­ï¼Œ`if` è¡¨è¾¾å¼åªèƒ½ç”¨å¸ƒå°”å€¼ä½œä¸ºæ¡ä»¶ï¼Œå³åªèƒ½åˆ¤æ–­å¸ƒå°”å˜é‡ä»¥åŠæ¡ä»¶è¡¨è¾¾å¼ã€‚

è¿˜å¯ä»¥ä½¿ç”¨ `else if` è¡¨è¾¾å¼æ¥å¢åŠ åˆ†æ”¯ï¼Œåªæœ‰ä¸€ä¸ªåˆ†æ”¯ä¼šè¢«æ‰§è¡Œï¼Œä¸€æ—¦æŸä¸ªåˆ†æ”¯ä¸º `true`ï¼Œå°±ä¸ä¼šåˆ¤æ–­ä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼š

```rust
fn main() {
    let number = 6;

    if number % 4 == 0 {
        println!("number is divisible by 4");
    } else if number % 3 == 0 {
        println!("number is divisible by 3"); // number is divisible by 3
    } else if number % 2 == 0 {
        println!("number is divisible by 2");
    } else {
        println!("number is not divisible by 4, 3, or 2");
    }
}
```

ä½¿ç”¨ `if` è¯­å¥ï¼Œå¯ä»¥å®ç°ä¸‹é¢çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œç±»ä¼¼äºæŸäº›è¯­è¨€ä¸­çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼š

```rust
fn main() {
    let condition = true;
    let number = if condition { 5 } else { 6 };

    println!("The value of number is: {}", number); // 5
}
```

å…¶ä¸­ï¼Œæ ¹æ®å‰é¢æœ‰å…³å‡½æ•°è¿”å›å€¼çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ `{}` ä¸­æ²¡æœ‰åˆ†å·ç»“å°¾çš„ä½œä¸ºè¿”å›å€¼ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥å†™å‡ºä¸‹é¢çš„è¯­å¥ï¼ŒåŒæ ·æ˜¯æ­£ç¡®çš„ï¼š

```rust
fn main() {
    let condition = true;
    let number = if condition {let x = 2; x+2} else {let x = 1; x+1};

    println!("The value of number is: {}", number); // 4
}
```

ç„¶è€Œ `if` å’Œ `else` è¯­å¥å—çš„å€¼ä¸èƒ½ä¸ºä¸åŒç±»å‹ï¼Œè¿™æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œè¿™æ˜¯å› ä¸º Rust éœ€è¦åœ¨ç¼–è¯‘æœŸç¡®å®šæ‰€æœ‰å˜é‡çš„ç±»å‹ï¼Œå¦‚æœ `if` å’Œ `else` èƒ½å¤Ÿå¾—åˆ°ä¸åŒç±»å‹çš„ç»“æœï¼Œé‚£ä¹ˆä¹Ÿå°±æ— æ³•çŸ¥é“å˜é‡ `number` çš„ç±»å‹ã€‚ä¸è¿‡ï¼Œè¿™å¹¶ä¸ä»£è¡¨è¿™æ ·çš„å®ç°æ˜¯ä¸å¯èƒ½çš„ï¼Œå¦‚æœç¼–è¯‘å™¨å¿…é¡»è·Ÿè¸ªä»»ä½•å˜é‡çš„å¤šä¸ªå‡è®¾ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°†æ›´åŠ å¤æ‚ï¼Œå¯¹ä»£ç çš„ä¿è¯ä¹Ÿä¼šæ›´å°‘ã€‚

#### å¾ªç¯

Rust æœ‰ä¸‰ç§å¾ªç¯è¯­å¥ï¼Œ`loop`ã€`while` å’Œ `for`ã€‚

##### loop

ç®€è€Œè¨€ä¹‹ï¼Œ`loop` è¯­å¥å°±æ˜¯æ— é™å¾ªç¯ï¼Œå®ƒæ²¡æœ‰æ¡ä»¶è¯­å¥ï¼Œä¹Ÿå°±ä¸èƒ½åœ¨å¾ªç¯ä¸Šè®©å…¶é€€å‡ºã€‚ä½†æ˜¯ `loop` å¯ä»¥é€šè¿‡å¾ªç¯ä½“å†…çš„è¯­å¥é€€å‡ºï¼š

```rust
fn main() {
    let mut count = 0; // ç»Ÿè®¡å¾ªç¯æ¬¡æ•°
    loop {
        if count == 5 {break;} // å½“ count ç­‰äº 5 åˆ™é€€å‡ºå¾ªç¯
        println!("hello");
        count += 1; // æ¬¡æ•°åŠ ä¸€
    }
}
```

æ¯‹åº¸ç½®ç–‘ï¼Œä¸Šé¢çš„ä»£ç ä¼šè¾“å‡ºäº”è¡Œ `hello`ã€‚

å…³äº `loop` è¯­å¥è¿˜æœ‰ä¸€ç‚¹æ¯”è¾ƒç‰¹åˆ«çš„æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›å€¼ï¼š

```rust
fn main() {
    let mut count = 0;
    let result = loop {
        if count == 5 {break count + 1;}
        println!("hello");
        count += 1;
    };
    println!("The value of result is: {}", result); // The value of result is: 6
}
```

å¯ä»¥çœ‹åˆ°ï¼Œ`break` å…³é”®å­—åé¢è·Ÿè¿”å›å€¼ï¼Œå°±èƒ½èµ‹å€¼ç»™ `result`ï¼Œå½“æ‰§è¡Œåˆ° `break` è¯­å¥å `loop` ç«‹å³è¿”å›äº† `count + 1`ã€‚

ç»“åˆå‰é¢çš„å†…å®¹ï¼Œå¯ä»¥çŸ¥é“ä¸‹é¢çš„ä»£ç ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼š

```rust
fn main() {
    let mut count = 0;
    let result = loop {
        if count == 5 {break {let x = 12; count + x};}
        println!("hello");
        count += 1;
    };
    println!("The value of result is: {}", result); // The value of result is: 17
}
```

`{let x = 12; count + x}` çš„å€¼ä¸º `count + x` å³ 17ï¼Œé€šè¿‡ `break` è¿”å›ç»™ `result`ã€‚

##### While

å¾ªç¯è¯­å¥ä¸­å†™å¾ªç¯æ¡ä»¶å¯ä»¥è®©å¾ªç¯å¤„ç†æ›´ç®€å•ï¼ŒRust æä¾›äº† `while` å¾ªç¯æ”¯æŒæŒ‡å®šå¾ªç¯æ¡ä»¶ï¼š

```rust
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{}!", number);

        number -= 1;
    }

    println!("LIFTOFF!!!"); // LIFTOFF!!!
}
```

è¿™å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€æ²¡ä»€ä¹ˆå¤§çš„åŒºåˆ«ï¼Œä¸å†èµ˜è¿°ã€‚

##### for

`for` å¾ªç¯ç”¨äºè¿­ä»£å…ƒç´ é›†åˆï¼Œå¦‚æ•°ç»„ï¼ˆArrayï¼‰ï¼Œè¿™ä½¿ç”¨å…¶ä»–ä¸¤ç§å¾ªç¯ä¹Ÿå¯ä»¥åšåˆ°ï¼š

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;

    while index < 5 {
        println!("the value is: {}", a[index]);

        index += 1;
    }
}

// 10
// 20
// 30
// 40
// 50
```

ä½†ä½¿ç”¨ `for` å¾ªç¯å¯ä»¥å°†ä¸Šé¢çš„è¯­å¥ç®€åŒ–ä¸ºä¸‹é¢çš„ï¼š

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];

    for element in a.iter() {
        println!("the value is: {}", element);
    }
}

// 10
// 20
// 30
// 40
// 50
```

è¿™æ ·çš„ä»£ç ä¼šæ›´å®‰å…¨ï¼Œå› ä¸ºä¸éœ€è¦æŒ‡å®šæ•°ç»„ä¸‹æ ‡ä¹‹ç±»ï¼Œä¸å­˜åœ¨è¶Šç•Œçš„é—®é¢˜ã€‚

ä¸‹é¢çš„è¯­å¥å¯ä»¥ç”¨äºç”Ÿæˆä¸€ä¸ªæ•°å­—èŒƒå›´ï¼Œç±»ä¼¼ Python ä¸­çš„å†™æ³•ï¼š

```rust
fn main() {
    for number in 1..4 {
        println!("{}!", number);
    }
    println!("LIFTOFF!!!");
}

// 1!
// 2!
// 3!
// LIFTOFF!!!
```

`1..4` å¾ˆæ˜æ˜¾ï¼Œæ˜¯ç”¨æ¥ç”ŸæˆèŒƒå›´ $[1,4)$ çš„ä¸‰ä¸ªæ•°å­—ï¼Œæ¥ç€ä½¿ç”¨ `for` å¾ªç¯éå†è¿™ä¸‰ä¸ªæ•°å­—å¹¶è¾“å‡ºã€‚

æˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„ä»£ç æ¥æŒ‡å®šä¸‹æ ‡ä»æ•°ç»„ä¸­å–å€¼ï¼š

```rust
fn main() {
    let arr = [10, 20, 30, 40, 50];
    for number in 3..5 {
        println!("{}", arr[number]);
    }
}

// 40
// 50
```

### ç»ƒä¹ 

1. ç”¨ç›®å‰å­¦ä¹ çš„å†…å®¹å†™ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°ï¼š

    ```rust
    fn fib(mut n: i32) {
        let mut pre = 1;
        let mut post = 1;
    
        while n > 2 {
            let tmp = post;
            post += pre;
            pre = tmp;
            n-=1;
        }
    
        println!("{}", post);
    }
    
    fn main() {
        fib(1);  // 1
        fib(2);  // 1
        fib(3);  // 2
        fib(10); // 55
    }
    ```

## æ‰€æœ‰æƒ

æ‰€æœ‰æƒï¼ˆOwnershipï¼‰æ˜¯ Rust æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå®ƒä½¿ Rust èƒ½å¤Ÿåœ¨ä¸éœ€è¦åƒåœ¾æ”¶é›†å™¨çš„æƒ…å†µä¸‹ä¿è¯å†…å­˜å®‰å…¨ã€‚å› æ­¤ï¼Œäº†è§£æ‰€æœ‰æƒåœ¨ Rust ä¸­çš„ä½œç”¨éå¸¸é‡è¦ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ‰€æœ‰æƒä»¥åŠå‡ ä¸ªç›¸å…³ç‰¹æ€§ï¼šå€Ÿç”¨ï¼ˆborrowingï¼‰ã€åˆ‡ç‰‡ï¼ˆslicesï¼‰ä»¥åŠ Rust å¦‚ä½•åœ¨å†…å­˜ä¸­å¸ƒå±€æ•°æ®ã€‚

> æ³¨ï¼šOwnership åº”å½“æ˜¯ Rust è¾ƒå¤æ‚çš„ä¸€éƒ¨åˆ†ï¼Œä½†å¯¹äºç†è§£å’ŒæŒæ¡ Rust ç¼–ç¨‹ç›¸å½“é‡è¦ï¼Œå› æ­¤æœ¬æ–‡éµå¾ª The Rust Programming Language çš„ç« èŠ‚å®‰æ’ï¼Œå…ˆä»‹ç»è¯¥éƒ¨åˆ†ã€‚

### ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ

æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™éƒ½å¿…é¡»ç®¡ç†å®ƒä»¬ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼ã€‚æœ‰äº›ç¼–ç¨‹è¯­è¨€ä½¿ç”¨åƒåœ¾å›æ”¶æœºåˆ¶æ¥ä¸æ–­åœ°å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼ˆå¦‚ Javaã€Goï¼‰ï¼›è¿˜æœ‰äº›ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¼€å‘è€…å¿…é¡»æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼ˆå¦‚ Cã€C++ï¼‰ã€‚Rust åˆ™å¦è¾Ÿè¹Šå¾„ï¼šå†…å­˜é€šè¿‡ä¸€ä¸ªæ‰€æœ‰æƒç³»ç»Ÿæ¥ç®¡ç†ï¼Œå®ƒå…·æœ‰ä¸€ç»„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥çš„è§„åˆ™ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒçš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚

Ownership å¯¹å¤§å¤šæ•°å­¦ä¹  Rust çš„äººæ¥è¯´æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦èŠ±ä¸€äº›æ—¶é—´æ¥å­¦ä¹ å’Œé€‚åº”ã€‚

> **æ ˆï¼ˆStackï¼‰å’Œå †ï¼ˆHeapï¼‰**
>
> åœ¨è®¸å¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¼€å‘è€…ä¸å¿…ç»å¸¸è€ƒè™‘æ ˆå’Œå †ã€‚ä½†æ˜¯åœ¨åƒ Rust è¿™æ ·çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå€¼ï¼ˆvalueï¼‰æ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯åœ¨å †ä¸Šå¯¹**è¯­è¨€çš„è¡Œä¸º**ä»¥åŠ**ä¸ºä»€ä¹ˆå¿…é¡»åšå‡ºæŸäº›å†³å®š**æœ‰å¾ˆå¤§çš„å½±å“ã€‚ä¸‹é¢ä½œå‡ºç®€è¦è¯´æ˜ã€‚
>
> æ ˆå’Œå †éƒ½æ˜¯å¯ä¾›ç¨‹åºåœ¨è¿è¡Œæ—¶ä½¿ç”¨çš„å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬çš„ç»“æ„ä¸åŒã€‚ç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­æ ˆçš„æ¦‚å¿µï¼Œå†…å­˜ä¸­çš„æ ˆç©ºé—´åŒæ ·æ»¡è¶³ LIFO çš„è§„åˆ™ï¼Œä¸å†èµ˜è¿°ã€‚æ ˆä¸Šå­˜å‚¨çš„æ‰€æœ‰æ•°æ®çš„å¤§å°å¿…é¡»åœ¨ç¼–è¯‘æœŸå·²çŸ¥ä¸”å›ºå®šï¼Œå¦‚æœç¼–è¯‘æœŸæ— æ³•ç¡®å®šä¸€ä¸ªæ•°æ®çš„å¤§å°æˆ–è€…å…¶å¤§å°å¯èƒ½å‘ç”Ÿæ”¹å˜ï¼Œé‚£å®ƒå°†è¢«åˆ†é…åˆ°å †ä¸Šã€‚å †çš„ç»„ç»‡æ€§è¾ƒå·®ï¼Œå½“æ•°æ®æ”¾åœ¨å †ä¸Šæ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šé‡çš„ç©ºé—´ï¼Œç„¶åç”±å†…å­˜åˆ†é…å™¨åœ¨å †ä¸Šæ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œå°†è¯¥ç©ºé—´æ ‡è®°ä¸ºæ­£åœ¨ä½¿ç”¨ï¼Œæ¥ç€è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œå³è¯¥åœ°å€çš„ä½ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºå †åˆ†é…ï¼ˆ*allocating on the heap*ï¼‰ï¼Œæœ‰æ—¶ç®€ç§°ä¸ºåˆ†é…ï¼ˆ*allocating*ï¼‰ã€‚å°†å€¼æ”¾åˆ°æ ˆä¸Šä¸è§†ä¸ºåˆ†é…ã€‚ç”±äºæŒ‡é’ˆæ˜¯å·²çŸ¥çš„å›ºå®šå¤§å°ï¼Œæ‰€ä»¥å¯ä»¥å°†æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼Œä½†å½“éœ€è¦å®é™…æ•°æ®æ—¶ï¼Œå¿…é¡»æ‰¾å¯»æŒ‡é’ˆçš„æŒ‡å‘åœ°å€ã€‚
>
> æ˜¾ç„¶ï¼Œåœ¨æ ˆä¸Šåˆ†é…å†…å­˜æ›´å¿«ï¼Œå› ä¸ºåªéœ€è¦ä»æ ˆé¡¶å…¥æ ˆå°±è¡Œäº†ï¼Œè€Œå †ä¸­ç”±äºç©ºé—²ç©ºé—´å¹¶ä¸ä¸€å®šè¿ç»­ï¼Œéœ€è¦èŠ±æ—¶é—´å¯»æ‰¾æ»¡è¶³çš„å †ç©ºé—´ï¼Œå¹¶è®°å½•å˜åŒ–ã€‚
>
> è®¿é—®å †ä¸­çš„æ•°æ®åŒæ ·æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ‰èƒ½æ‰¾åˆ°ç›®æ ‡ä½ç½®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­çš„è·³è·ƒè¶Šå°‘ï¼Œåˆ™é€Ÿåº¦è¶Šå¿«ã€‚ç»§ç»­ç±»æ¨ï¼Œè€ƒè™‘ä¸€å®¶é¤é¦†çš„æœåŠ¡å‘˜ä»è®¸å¤šè¡¨æ ¼ä¸­è·å–è®¢å•çš„ä¾‹å­ã€‚åœ¨å»åˆ°ä¸‹ä¸€å¼ æ¡Œå­ä¹‹å‰ï¼Œåœ¨ä¸€å¼ æ¡Œå­ä¸Šæ‹¿åˆ°æ‰€æœ‰è®¢å•æ˜¯æœ€é«˜æ•ˆçš„ã€‚ä»è¡¨ A è·å–è®¢å•ï¼Œç„¶åä»è¡¨ B è·å–è®¢å•ï¼Œç„¶åå†ä» A è·å–è®¢å•ï¼Œç„¶åå†ä» B è·å–è®¢å•å°†æ˜¯ä¸€ä¸ªæ…¢å¾—å¤šçš„è¿‡ç¨‹ã€‚åŒæ ·ï¼Œå¦‚æœå¤„ç†å™¨å¤„ç†çš„æ•°æ®ä¸å…¶ä»–æ•°æ®ç›¸è¿‘ï¼ˆå¦‚æ ˆä¸Šçš„æ•°æ®ï¼‰ï¼Œè€Œä¸æ˜¯è·ç¦»è¾ƒè¿œï¼ˆå¦‚å †ä¸Šçš„æ•°æ®ï¼‰ï¼Œåˆ™å¤„ç†å™¨å¯ä»¥æ›´å¥½åœ°å®Œæˆå…¶å·¥ä½œã€‚åœ¨å †ä¸Šåˆ†é…å¤§é‡ç©ºé—´ä¹Ÿéœ€è¦æ—¶é—´ã€‚
>
> å½“ä»£ç è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ é€’åˆ°å‡½æ•°ä¸­çš„å€¼ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯å‡½æ•°å‚æ•°ï¼Œå¯èƒ½åŒ…æ‹¬æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“å‡½æ•°ç»“æŸï¼ˆè¿”å›ï¼‰æ—¶ï¼Œè¿™äº›å€¼ä¼šä»æ ˆä¸­å¼¹å‡ºã€‚
>
> è·Ÿè¸ªä»£ç çš„å“ªäº›éƒ¨åˆ†æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å°åŒ–å †ä¸Šçš„é‡å¤æ•°æ®é‡ï¼Œæ¸…ç†å †ä¸Šæœªä½¿ç”¨çš„æ•°æ®ä»¥é¿å…è€—å°½ç©ºé—´ï¼Œè¿™äº›éƒ½æ˜¯æ‰€æœ‰æƒæ‰€è¦è§£å†³çš„é—®é¢˜ã€‚ä¸€æ—¦äº†è§£äº†æ‰€æœ‰æƒï¼Œå°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †ï¼Œä½†æ˜¯æ˜ç™½**ç®¡ç†å †æ•°æ®**æ˜¯æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› æœ‰åŠ©äºç†è§£å®ƒä¸ºä»€ä¹ˆä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚

#### Ownership è§„åˆ™

é¦–å…ˆç‰¢è®°ä»¥ä¸‹è§„åˆ™ï¼š

- Rust ä¸­çš„æ¯ä¸ªå€¼ï¼ˆvalueï¼‰éƒ½æœ‰ä¸€ä¸ªç§°ä¸ºå…¶æ‰€æœ‰è€…ï¼ˆownerï¼‰çš„å˜é‡ã€‚
- ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
- å½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸèŒƒå›´ï¼ˆå³ç¨‹åºä¸èƒ½è®¿é—®å®ƒï¼‰æ—¶ï¼Œè¯¥å€¼å°†è¢«åˆ é™¤ã€‚

#### å˜é‡ä½œç”¨åŸŸ

å˜é‡ä½œç”¨åŸŸï¼ˆVariable Scopeï¼‰æŒ‡çš„æ˜¯æŸä¸ªå˜é‡çš„ä½œç”¨èŒƒå›´ï¼Œå³å®ƒå¯¹å…¶ä»–ä»£ç å¯è§çš„èŒƒå›´ã€‚

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ`x` çš„ä½œç”¨åŸŸå°±æ˜¯æ•´ä¸ª `main` å‡½æ•°ï¼Œåœ¨ `main` å‡½æ•°å†… `x` å¯ä»¥è¢«ä»»ä½•è¯­æ³•è®¿é—®ã€‚

```rust
fn main() {
    let x = 1;
    println!("{}", x); // 1
}
```

åœ¨ Rust ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `{}` æŒ‡å®šä¸€å—ä½œç”¨åŸŸï¼š

```rust
fn main() {
    let x = 5;
    {
        let y = 6;
    }
    println!("{}", x);
    println!("{}", y);
}
```

ä¸Šé¢çš„ä»£ç ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä¼šå‡ºç° `` cannot find value `y` in this scope `` çš„æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º`y`åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸé‡Œï¼Œå¤–éƒ¨æ— æ³•è®¿é—®åˆ°å®ƒã€‚

ä½œç”¨åŸŸèƒ½å¤Ÿè®¿é—®åˆ°å…¶å¤–éƒ¨çš„ä½œç”¨åŸŸï¼Œå› æ­¤ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ`x` å’Œ `y` éƒ½èƒ½è¢«æ‰“å°å‡ºæ¥ï¼š

```rust
fn main() {
    let x = 5;
    {
        let y = 6;
        println!("{}", x); // 5
        println!("{}", y); // 6
    }
    // println!("{}", x);
    // println!("{}", y);
}
```

ç°åœ¨æ¥åˆ†æä¸€ä¸‹ä½œç”¨åŸŸçš„ç”Ÿå‘½å‘¨æœŸï¼š

```rust
fn main() {
    {                      // å˜é‡ s ä¸å¯ç”¨, å› ä¸ºå®ƒè¿˜æ²¡æœ‰è¢«å£°æ˜
        let s = "hello";   // å˜é‡ s ç°åœ¨å¯ç”¨

        // å¤„ç† s ç›¸å…³çš„ä»£ç 
    }                      // ä½œç”¨åŸŸç»“æŸï¼Œs ä¸å†å¯ç”¨
}
```

ä¹Ÿå°±æ˜¯è¯´ `s` çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»å…¶è¢«å£°æ˜ç›´åˆ°é‡åˆ° `}` å…¶ä½œç”¨åŸŸç»“æŸçš„è¿™ä¸ªåŒºé—´ã€‚

å°±ç›®å‰æ¥çœ‹ï¼ŒRust ä¸­å˜é‡ä½œç”¨åŸŸæœºåˆ¶å’Œå…¶ä»–å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­çš„å˜é‡ä½œç”¨åŸŸæœºåˆ¶å¾ˆè¿‘ä¼¼ã€‚ç°åœ¨æˆ‘ä»¬å¼•å…¥å­—ç¬¦ä¸²ç±»å‹å†è¿›è¡Œæ¢è®¨ã€‚

#### å­—ç¬¦ä¸²ç±»å‹

å‰é¢ä»‹ç»çš„æ•°æ®ç±»å‹éƒ½å­˜å‚¨åœ¨æ ˆä¸Šï¼Œåœ¨å®ƒä»¬æ‰€åœ¨çš„ä½œç”¨åŸŸç»“æŸï¼ˆå¦‚å‡½æ•°è¿”å›ï¼‰åå°±ä¼šè¢«å¼¹å‡ºæ ˆç©ºé—´ã€‚æˆ‘ä»¬ç°åœ¨çœ‹çœ‹å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®ï¼Œå¹¶æ¢ç©¶ Rust å¦‚ä½•çŸ¥é“ä½•æ—¶æ¸…ç†è¿™äº›æ•°æ®ã€‚

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `String`ï¼ˆå­—ç¬¦ä¸²ï¼‰ç±»å‹ä½œä¸ºç¤ºä¾‹ï¼Œé‡ç‚¹ä»‹ç» `String` ä¸­ä¸æ‰€æœ‰æƒç›¸å…³çš„éƒ¨åˆ†ã€‚è¿™äº›éƒ¨åˆ†ä¹ŸåŒæ ·é€‚ç”¨äºå…¶ä»–å¤æ‚æ•°æ®ç±»å‹ï¼ˆæ— è®ºå®ƒä»¬æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„è¿˜æ˜¯ç”±ç¨‹åºå‘˜è‡ªè¡Œåˆ›å»ºçš„ï¼‰ã€‚

æˆ‘ä»¬æ—©å·²ç»è§è¿‡å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆstring literalsï¼‰ï¼Œå¦‚ `"hello world!"`ï¼Œè¿™æ˜¯å†™åœ¨ä»£ç ä¸­çš„ä¸€æ®µå­—ç¬¦ä¸²ã€‚ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡å¾ˆç›´è§‚ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†å¯èƒ½å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰éœ€è¦è¿›è¡Œæ–‡æœ¬å¤„ç†çš„æƒ…å†µã€‚å…¶ä¸­ä¸€ä¸ªåŸå› æ˜¯å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜ï¼ˆ*immutable*ï¼‰çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯å­—ç¬¦ä¸²å†…å®¹å¾ˆå¯èƒ½æ˜¯åœ¨è¿è¡Œæ—¶æ‰èƒ½å¤Ÿè¢«ç¡®å®šçš„ï¼ˆæ¯”å¦‚æ˜¯ç”±ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼‰ã€‚å‡ºäºè¿™äº›æƒ…å†µï¼ŒRust æä¾›äº†ä¸åŒäºå­—ç¬¦ä¸²å­—é¢é‡çš„ `String` ç±»å‹ã€‚è¿™ä¸ªç±»å‹æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼ˆè€Œå­—ç¬¦ä¸²å­—é¢é‡åœ¨æ ˆä¸Šï¼‰ï¼Œå› æ­¤èƒ½å¤Ÿå­˜å‚¨å¤§é‡åœ¨ç¼–è¯‘æ—¶æœªçŸ¥çš„æ–‡æœ¬ã€‚

`String` çš„ç”¨æ³•å¦‚ä¸‹ï¼š

```rust
let s = String::from("hello"); // ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»ºä¸€ä¸ª String
```

å…¶ä¸­ï¼Œ`::` æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œåœ¨è¿™é‡Œç”¨äºè°ƒç”¨ `String` ç±»å‹å‘½åç©ºé—´ä¸‹çš„ `from` å‡½æ•°ã€‚

ç°åœ¨å¯ä»¥ä½¿ç”¨å¯å˜çš„å­—ç¬¦ä¸²äº†ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    s.push_str(", world!"); // push_str() å°†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡æ”¾å…¥ä¸€ä¸ª String ä¸­

    println!("{}", s); // hello, world!
}
```

ä»å­—ç¬¦ä¸²çš„ä¾‹å­ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå­—ç¬¦ä¸²å­—é¢é‡ä¸å¯å˜ï¼Œä½† `String` å¯å˜ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸¤ç§ç±»å‹å¤„ç†å†…å­˜çš„æ–¹å¼ä¸åŒã€‚

#### å†…å­˜å’Œå†…å­˜åˆ†é…

ç”±äºå­—ç¬¦ä¸²å­—é¢é‡æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šçš„ï¼Œå› æ­¤å®ƒå¯ä»¥è¢«ç›´æ¥ç¡¬ç¼–ç åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™ä¹Ÿæ˜¯å­—ç¬¦ä¸²å­—é¢é‡å¿«é€Ÿå¹¶é«˜æ•ˆçš„åŸå› ã€‚ä½†å…¶é«˜æ•ˆçš„å‰ææ˜¯å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯å˜çš„ã€‚æˆ‘ä»¬æ— æ³•å°†**åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥**æˆ–æ˜¯**åœ¨ç¨‹åºè¿è¡Œæ—¶å¤§å°å¯èƒ½ä¼šæ”¹å˜**çš„æ–‡æœ¬æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚

å¯¹äº `String` ç±»å‹ï¼Œä¸ºäº†æ”¯æŒå¯å˜çš„ã€å¯å¢é•¿çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å®šé‡çš„å†…å­˜ï¼ˆç¼–è¯‘æ—¶æœªçŸ¥ï¼‰æ¥ä¿å­˜å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š

- å¿…é¡»åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä»å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚

- æˆ‘ä»¬éœ€è¦ä¸€ç§åœ¨å¤„ç†å®Œ `String` åå°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ï¼ˆå³å›æ”¶å†…å­˜ï¼‰ã€‚

ç¬¬ä¸€ç‚¹ç”±ç¼–ç¨‹äººå‘˜å®Œæˆï¼Œé€šè¿‡è°ƒç”¨å¦‚ `String::from` çš„å‡½æ•°æ¥å®ç°è¯·æ±‚æ‰€éœ€çš„å†…å­˜ã€‚è¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­éå¸¸æ™®éã€‚

ç„¶è€Œï¼Œç¬¬äºŒç‚¹å°±æœ‰ä¸€äº›ä¸åŒäº†ã€‚åœ¨ä½¿ç”¨åƒåœ¾å›æ”¶ï¼ˆ*garbage collector, GC*ï¼‰æœºåˆ¶çš„è¯­è¨€ä¸­ï¼ŒGC è·Ÿè¸ªå¹¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç¼–ç¨‹äººå‘˜æ— éœ€è€ƒè™‘è¿™äº›ã€‚å¦‚æœæ²¡æœ‰ GCï¼Œç¼–ç¨‹äººå‘˜å°±éœ€è¦åˆ¤æ–­å†…å­˜ä½•æ—¶ä¸å†è¢«ä½¿ç”¨ï¼Œå¹¶è°ƒç”¨ä»£ç æ˜¾å¼è¿”å›ï¼ˆreturnï¼‰å®ƒï¼Œå°±åƒæˆ‘ä»¬è¯·æ±‚ï¼ˆrequestï¼‰å®ƒä¸€æ ·ã€‚ç„¶è€Œå®Œå…¨æ­£ç¡®åœ°æ‰§è¡Œæ­¤æ“ä½œå†æ¥æ˜¯ä¸€ä¸ªç›¸å½“å›°éš¾çš„ç¼–ç¨‹é—®é¢˜ã€‚å¦‚æœå¿˜è®°äº†å›æ”¶å†…å­˜ï¼Œè½»åˆ™é€ æˆå†…å­˜æµªè´¹ï¼Œé‡åˆ™å‡ºç°å¤§é‡å†…å­˜æ³„æ¼ï¼Œå¯¼è‡´å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤§ï¼›ç„¶è€Œå¦‚æœå›æ”¶çš„è¿‡æ—©ï¼Œä¼šå¯¼è‡´æŸäº›ä»éœ€è¦ä½¿ç”¨çš„å˜é‡å¤±æ•ˆï¼Œå‡ºç°æ‚¬æŒ‚æŒ‡é’ˆï¼ˆ*dangling pointer*ï¼‰é—®é¢˜ï¼›å¦‚æœé‡å¤è¿›è¡Œäº†å›æ”¶ï¼Œè¿™åŒæ ·ä¼šå¯¼è‡´ç¨‹åº bugã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å°† `allocate`ï¼ˆåˆ†é…ï¼‰å’Œ `free`ï¼ˆå›æ”¶ï¼‰æ“ä½œå‡†ç¡®åœ°é…å¯¹ã€‚

Rust é‡‡ç”¨äº†ä¸åŒçš„è·¯å¾„ï¼š**ä¸€æ—¦å ç”¨å†…å­˜çš„å˜é‡è¶…å‡ºä½œç”¨åŸŸï¼Œå†…å­˜å°±ä¼šè‡ªåŠ¨è¿”å›ã€‚**

çœ‹ä¸‹é¢ä¸€æ®µä»£ç ï¼Œä½¿ç”¨äº† `String` ç±»å‹å£°æ˜å˜é‡ `s`ï¼š

```rust
fn main() {
    {
        let s = String::from("hello"); // å˜é‡ s è¢«åˆå§‹åŒ–

        // å¤„ç† s ç›¸å…³çš„ä»£ç 
    } // ä½œç”¨åŸŸç»“æŸï¼Œs ä¸å†å¯ç”¨

}
```

æ³¨æ„ä½œç”¨åŸŸç»“æŸçš„åœ°æ–¹ `}`ï¼Œå½“è¿™ä¸ªä½œç”¨åŸŸç»“æŸï¼Œ`s` å³ä¸å†å¯ç”¨ï¼Œä¹Ÿå°±å¯ä»¥å›æ”¶å…¶å†…å­˜äº†ã€‚Rust åœ¨è¿™æ—¶ä¼šè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•° `drop`ï¼Œ`String` çš„ä½œè€…ï¼ˆauthorï¼Œè¿™ä¸ªä½œè€…æŒ‡çš„æ˜¯ `String` æ ‡å‡†åº“çš„å¼€å‘è€…ï¼Œå¹¶éä½¿ç”¨è€…ï¼‰å¯ä»¥åœ¨è¿™é‡Œæ”¾ç½®ä»£ç ä»¥è¿”å›å†…å­˜ã€‚

> æ³¨ï¼šåœ¨ C++ ä¸­ï¼Œåœ¨é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶é‡Šæ”¾èµ„æºçš„è¿™ç§æ¨¡å¼æœ‰æ—¶ç§°ä¸º *Resource Acquisition Is Initialization*ï¼ˆ*RAII*ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨è¿‡ RAII æ¨¡å¼ï¼ŒRust ä¸­çš„ drop å‡½æ•°å¯¹ä½ æ¥è¯´ä¼šå¾ˆç†Ÿæ‚‰ã€‚

> ã€æˆªè‡³å†™ä¸‹æœ¬æ–‡ï¼Œæˆ‘éƒ½è¿˜ä¸ä¼š C++ï¼Œæˆ‘çš„ä¸‹åŠç”Ÿä¼°è®¡æ˜¯åºŸäº† o(T ãƒ˜ To)ã€‘

ä¸Šè¿°æ¨¡å¼å¯¹ Rust ä»£ç çš„ç¼–å†™æ–¹å¼æœ‰ç€æ·±è¿œçš„å½±å“ã€‚ç°åœ¨çœ‹èµ·æ¥å¯èƒ½å¾ˆç®€å•ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æƒ³è¦è®©å¤šä¸ªå˜é‡ä½¿ç”¨æˆ‘ä»¬åœ¨å †ä¸Šåˆ†é…çš„æ•°æ®æ—¶ï¼Œä»£ç çš„è¡Œä¸ºå¯èƒ½ä¼šå‡ºäººæ„æ–™ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥æ¢è®¨å…¶ä¸­çš„ä¸€äº›æƒ…å†µã€‚

#### å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šç§»åŠ¨

åœ¨ Rust ä¸­ï¼Œå¤šä¸ªå˜é‡å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼ä¸ç›¸åŒçš„æ•°æ®äº¤äº’ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```rust
let x = 5;
let y = x;
```

æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çŒœåˆ°è¿™æ˜¯åœ¨åšä»€ä¹ˆï¼šâ€œå°†å€¼ 5 ç»‘å®šåˆ° `x`ï¼Œç„¶åå¤åˆ¶ `x` ä¸­çš„å€¼å¹¶å°†å…¶ç»‘å®šåˆ° `y`ã€‚â€æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªå˜é‡ï¼Œ`x` å’Œ `y`ï¼Œå®ƒä»¬éƒ½ç­‰äº 5ã€‚è¿™ç¡®å®æ˜¯å®é™…çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå› ä¸ºæ•´æ•°æ˜¯å…·æœ‰å·²çŸ¥å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œè¿™ä¸¤ä¸ª 5 ä¼šè¢«å‹å…¥æ ˆã€‚

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ `String` çš„ç‰ˆæœ¬ï¼š

```rust
let s1 = String::from("hello");
let s2 = s1;
```

è¿™å’Œå›ºå®šå¤§å°çš„ `i32` æ•´æ•°æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œå®ƒå¹¶ä¸æ˜¯ä» `s1` ç›´æ¥å¤åˆ¶å€¼å¹¶èµ‹ç»™ `s2` çš„ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹ `String` èƒŒåçš„ç»“æ„ï¼š

![String in memory](Learning-Rust/trpl04-01.svg)

> æ³¨ï¼šéå•ç‹¬æ³¨æ˜ï¼Œå›¾ç‰‡å‡æ¥è‡ª [The Rust Programming Language](https://doc.rust-lang.org/book/title-page.html)ã€‚

è¿™å’Œ Go å¯¹å­—ç¬¦ä¸²ç±»å‹çš„å®ç°åŸºæœ¬ç›¸åŒã€‚

å…¶ä¸­ï¼Œå·¦è¾¹çš„éƒ¨åˆ†æ˜¯ä½äºæ ˆä¸Šçš„ï¼Œå³è¾¹çš„éƒ¨åˆ†åœ¨å †ä¸Šã€‚é•¿åº¦ï¼ˆlenï¼‰è¡¨ç¤ºå½“å‰å­—ç¬¦ä¸²å·²ç»å ç”¨çš„ç©ºé—´å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œå®¹é‡ï¼ˆcapacityï¼‰è¡¨ç¤ºå¯ä¾›ä½¿ç”¨çš„ç©ºé—´å¤§å°ï¼Œå³åº•å±‚æ•°ç»„çš„å®é™…å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚å½“å¤åˆ¶ `s1` æ—¶ï¼Œä»…ä»…æ˜¯å¤åˆ¶äº†æ ˆä¸­çš„éƒ¨åˆ†ï¼Œå› æ­¤æ˜¯ä¸‹å›¾çš„ç»“æœï¼š

![s1 and s2 pointing to the same value](Learning-Rust/trpl04-02.svg)

ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œ`s1` å’Œ `s2` å®é™…çš„å†…å®¹æ˜¯ç›¸åŒçš„ã€‚å‡è®¾ Rust åŒæ—¶ä¹Ÿä¼šå¤åˆ¶å †æ•°æ®ä¼šæ€æ ·ï¼Ÿå¦‚ä¸‹å›¾çš„æƒ…å†µï¼š

![s1 and s2 to two places](Learning-Rust/trpl04-03.svg)

å¯ä»¥é¢„è§ï¼Œå½“å­—ç¬¦ä¸²å ç”¨å¤§é‡ç©ºé—´æ—¶ï¼Œå¯¹å…¶è¿›è¡Œå¤åˆ¶ä¼šè€—è´¹ç›¸å½“çš„æ—¶é—´å’Œç©ºé—´ã€‚ä¸‹é¢æˆ‘ä»¬ä¸¢æ‰è¿™ä¸ªå‡è®¾ï¼Œçœ‹å®é™…çš„æƒ…å†µã€‚

å‰é¢æˆ‘ä»¬æåˆ°äº†ï¼Œå› ä¸ºæ‰€æœ‰æƒæœºåˆ¶ï¼Œå˜é‡è¶…å‡ºä½œç”¨åŸŸä¼šç«‹å³é‡Šæ”¾å †å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆå¯¹äºå…·æœ‰ç›¸åŒå†…å­˜ç©ºé—´æ¥è¯´çš„ `s1` å’Œ `s2`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ˜¾ç„¶ï¼Œä¼šè°ƒç”¨ä¸¤æ¬¡ `drop()` æ¥é‡Šæ”¾åŒä¸€å—å†…å­˜ï¼Œè¿™è¢«ç§°ä¸º**åŒé‡é‡Šæ”¾**ï¼ˆ*double free*ï¼‰é”™è¯¯ï¼Œæ˜¯æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å†…å­˜å®‰å…¨é”™è¯¯ä¹‹ä¸€ã€‚

ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œåœ¨ `s2 = s1` è¿™æ¡è¯­å¥åï¼ŒRust å°±ä¼šè®¤ä¸º `s1` ä¸å†æœ‰æ•ˆäº†ï¼Œå› æ­¤æ— éœ€å†é‡Šæ”¾ `s1`ï¼Œä½œç”¨åŸŸç»“æŸæ—¶é‡Šæ”¾ `s2` å³å¯ã€‚è¿™ç›´æ¥å¯¼è‡´äº†ä¸‹é¢çš„ç°è±¡ï¼š

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;
    println!("{}", s1);
    println!("{}", s2);
}
```

```shell
$ cargo run
   Compiling ownership v0.1.0
error[E0382]: borrow of moved value: `s1`
  --> src\main.rs:15:20
   |
12 |     let s1 = String::from("hello");
   |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
13 | 
14 |     let s2 = s1;
   |              -- value moved here
15 |     println!("{}", s1);
   |                    ^^ value borrowed here after move

For more information about this error, try `rustc --explain E0382`.
error: could not compile `ownership` due to previous error
```

å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘ç›´æ¥å‡ºé”™äº†ï¼Œå…¶åŸå› æ˜¯ `s1` å·²ç»å¤±æ•ˆäº†ã€‚å°è¯•ä¿®æ”¹ä¸ºä¸‹é¢çš„ä»£ç ï¼Œå†æ¬¡è¿è¡Œï¼š

```rust
fn main() {
    let s1 = String::from("hello");
    println!("{}", s1);  // hello
    let s2 = s1;
    println!("{}", s2);  // hello
}
```

è¿™ä¸€æ¬¡å°±æ­£å¸¸è¾“å‡ºäº†æ„æ–™ä¹‹ä¸­çš„ç»“æœã€‚

å¦‚æœä½ åœ¨ä½¿ç”¨å…¶ä»–è¯­è¨€æ—¶å¬è¯´è¿‡**æµ…æ‹·è´**ï¼ˆ*shallow copy*ï¼‰å’Œ**æ·±æ‹·è´**ï¼ˆ*deep copy*ï¼‰è¿™ä¸¤ä¸ªæœ¯è¯­ï¼Œé‚£ä¹ˆå¤åˆ¶æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸å¤åˆ¶å †ä¸­æ•°æ®çš„æ¦‚å¿µå¯èƒ½å¬èµ·æ¥åƒè¿›è¡Œæµ…æ‹·è´ã€‚ä½†æ˜¯ç”±äº Rust ä¼šè®©ç¬¬ä¸€ä¸ªå˜é‡æ— æ•ˆï¼Œå› æ­¤è¿™ä¸ªæ¦‚å¿µæ²¡æœ‰è¢«å«åšæµ…æ‹·è´ï¼Œå®ƒè¢«ç§°ä¸º**ç§»åŠ¨**ï¼ˆ*move*ï¼‰ã€‚åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šè¯´ `s1` è¢«ç§»åŠ¨åˆ°äº† `s2` ä¸­ï¼Œå³æŠŠ `s1` æ”¾åˆ° `s2` ä¸­å¹¶åˆ é™¤ `s1`ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¯´è§£å†³äº†åŒé‡é‡Šæ”¾çš„é—®é¢˜ã€‚ä»è¿™ä¸ªè®¾è®¡ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒRust æ°¸è¿œä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªâ€œæ·±æ‹·è´â€ï¼Œå› æ­¤ï¼Œä»»ä½•è‡ªåŠ¨åŒ–çš„å¤åˆ¶è¡Œä¸ºéƒ½æ˜¯æ€§èƒ½å¾ˆä¼˜è‰¯çš„ã€‚

#### å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šå…‹éš†

å¦‚æœæƒ³è¦æ·±æ‹·è´ `String` çš„å †ä¸­æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å«åš `clone` çš„é€šç”¨æ–¹æ³•ã€‚

> æ–¹æ³•ï¼ˆmethodï¼‰æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ç¼–ç¨‹è¯­è¨€ç»„æˆéƒ¨åˆ†ï¼Œåœ¨åæ–‡ä¸­æ‰ä¼šå¯¹æ–¹æ³•è¿›è¡Œä»‹ç»ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1.clone();
    println!("s1 = {}, s2 = {}", s1, s2);
}
```

ä¸Šé¢è¿™æ®µä»£ç æ˜¾å¼åœ°è¿›è¡Œäº† `s1` çš„æ·±æ‹·è´ã€‚é€šè¿‡ `clone` æ–¹æ³•è¿›è¡Œæ“ä½œï¼Œèƒ½å¤Ÿæé†’å¼€å‘è€…æ³¨æ„è¿™æ ·çš„æ“ä½œæ˜¯å¯èƒ½å½±å“æ€§èƒ½çš„ï¼Œè¦ä¸‰æ€è€Œåè¡Œã€‚

#### ä»…å­˜åœ¨æ ˆä¸Šçš„æ•°æ®ï¼šå¤åˆ¶

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‚£äº›åªå­˜å‚¨åœ¨æ ˆä¸Šçš„æ•°æ®æ˜¯æ²¡æœ‰æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ†çš„ï¼Œæ‹·è´å®ƒä»¬ä¸ä¼šå¯¼è‡´å„ç§é—®é¢˜ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š

```rust
fn main() {
    let x = 5;
    let y = x;

    println!("x = {}, y = {}", x, y);
}
```

å¤§å°ç¡®å®šçš„ç±»å‹å¹¶ä¸éœ€è¦ `clone` è¿™æ ·çš„æ–¹æ³•æ¥è¿›è¡Œå¤åˆ¶ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ ˆä¸Šï¼Œè€Œä¸æ˜¯å †ä¸Šã€‚å¯¹è¿™æ ·å¤§å°ç¡®å®šçš„æ ˆæ•°æ®çš„å¤åˆ¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚

Rust æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ³¨è§£ï¼ˆannotationï¼‰å«åš `Copy` traitï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åœ¨åƒæ•´æ•°ï¼ˆintegerï¼‰è¿™æ ·å­˜å‚¨åœ¨æ ˆä¸­çš„ç±»å‹ä¸Šã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† `Copy` traitï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹çš„ä¸€ä¸ªæ—§çš„å˜é‡åœ¨èµ‹ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ï¼ˆå°±åƒä¸Šé¢çš„é‚£æ®µä»£ç ä¸­çš„ `x`ï¼Œèµ‹å€¼ç»™ `y` åä»ç„¶å¯ç”¨ï¼‰ã€‚å¦‚æœä¸€ä¸ªç±»å‹æˆ–è€…è¿™ä¸ªç±»å‹çš„ä»»ä½•éƒ¨åˆ†å®ç°äº† `Drop` traitï¼ŒRust å°±ä¼šä¸å…è®¸ä½¿ç”¨ `Copy` trait æ³¨è§£è¯¥ç±»å‹ã€‚

å¦‚æœæŸä¸ªç±»å‹çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶éœ€è¦è¿›è¡ŒæŸäº›ç‰¹æ®Šå¤„ç†ï¼Œæˆ‘ä»¬å¯¹è¯¥å˜é‡ä½¿ç”¨ `Copy` æ³¨è§£ä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ã€‚

> å…³äº Traitï¼Œè¿™æ˜¯ä¸€ç§ Rust ä¸­çš„æ¦‚å¿µï¼Œå°†åœ¨åæ–‡ä¸­è¿›è¡Œä»‹ç»ï¼Œæš‚æ—¶å¯ä»¥å¿½ç•¥ã€‚éœ€è¦äº†è§£å¦‚ä½•å°† `Copy` æ³¨è§£æ·»åŠ åˆ°ç±»å‹ä¸­ä»¥å®ç° traitï¼Œè¯·å‚é˜… [Derivable  Traits](https://doc.rust-lang.org/book/appendix-03-derivable-traits.html)ã€‚

é‚£ä¹ˆä»€ä¹ˆç±»å‹å®ç°äº† `Copy` traitï¼Ÿå¯ä»¥æŸ¥çœ‹ç»™å®šç±»å‹çš„æ–‡æ¡£æ¥ç¡®å®šï¼Œä½†ä½œä¸ºä¸€ä¸ªé€šç”¨çš„è§„åˆ™ï¼Œä»»ä½•ä¸€ç»„ç®€å•çš„**æ ‡é‡å€¼**éƒ½å¯ä»¥å®ç° `Copy`ï¼Œå¹¶ä¸”ä»»ä½•ä¸éœ€è¦å†…å­˜åˆ†é…ï¼ˆallocationï¼ŒæŒ‡å‰æ–‡æ‰€æåˆ°çš„åœ¨å †ä¸­åˆ†é…ï¼‰å’ŒæŸäº›å½¢å¼èµ„æºçš„ç±»å‹éƒ½å¯ä»¥å®ç° `Copy`ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®ç° `Copy` çš„ç±»å‹ï¼š

- æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œä¾‹å¦‚ `u32`ï¼›
- å¸ƒå°”ç±»å‹ `bool`ï¼›
- æ‰€æœ‰æµ®ç‚¹ç±»å‹ï¼Œä¾‹å¦‚ `f64`ï¼›
- å­—ç¬¦ç±»å‹ï¼Œ`char`ï¼›
- Tupleï¼Œå¦‚æœåªåŒ…å«åŒæ ·å®ç° `Copy` çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ`(i32, i32)` å®ç°äº† `Copy`ï¼Œä½† `(i32, String)` æ²¡æœ‰ã€‚

#### æ‰€æœ‰æƒå’Œå‡½æ•°

å°†å€¼ä¼ é€’ç»™å‡½æ•°ç±»ä¼¼äºä¸ºå˜é‡èµ‹å€¼ã€‚å’Œå˜é‡èµ‹å€¼ä¸€æ ·ï¼Œå°†å˜é‡ä¼ é€’ç»™å‡½æ•°ä¼šå‡ºç°ç§»åŠ¨ï¼ˆmoveï¼‰æˆ–å¤åˆ¶ï¼ˆcopyï¼‰ã€‚çœ‹ä¸‹é¢çš„ä¸€æ®µä»£ç ï¼š

```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼è¢«ç§»åŠ¨ï¼ˆmoveï¼‰åˆ°äº† takes_ownership å‡½æ•°ä¸­ï¼Œ
                                    // å› æ­¤å®ƒä¸å†å¯ç”¨äº†

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

    makes_copy(x);                  // x è¢«ä¼ å…¥ makes_copy å‡½æ•°,
                                    // ä½†æ˜¯å› ä¸º i32 ç±»å‹å®ç°äº† Copy,
                                    // å› æ­¤åœ¨æ¥ä¸‹æ¥è¿˜èƒ½å¤Ÿè¢«ä½¿ç”¨

} // x ç¦»å¼€ä½œç”¨åŸŸ, æ¥ç€ s ç¦»å¼€ä½œç”¨åŸŸ. ä½†æ˜¯ç”±äº s çš„æ‰€æœ‰æƒè¢«æ‹¿èµ°äº†ï¼Œå› æ­¤ä¸ä¼šæœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ“ä½œ

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // some_string ç¦»å¼€ä½œç”¨åŸŸï¼Œæ¥ç€ drop() è¢«è°ƒç”¨ä»¥å›æ”¶å†…å­˜

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // some_integer ç¦»å¼€ä½œç”¨åŸŸï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„æ“ä½œ
```

å¦‚æœè°ƒç”¨ `takes_ownership()` ä¹‹åå°è¯•ä½¿ç”¨ `s`ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚è¿™äº›é™æ€æ£€æŸ¥èƒ½å¤Ÿä½¿æˆ‘ä»¬å…äºå‡ºé”™ã€‚

#### è¿”å›å€¼å’Œä½œç”¨åŸŸ

è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒï¼š

```rust
fn main() {
    let s1 = gives_ownership();         // s1 è·å¾—äº† gives_ownership() è¿”å›å€¼çš„æ‰€æœ‰æƒ

    let s2 = String::from("hello");

    let s3 = takes_and_gives_back(s2);  // s2 çš„æ‰€æœ‰æƒäº¤ç»™äº† takes_and_gives_back() çš„å‚æ•°ï¼Œ
                                        // ä½†åˆé€šè¿‡è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼ ç»™äº† s3
} // s3ã€s1 ç»ç”± drop() å›æ”¶

fn gives_ownership() -> String {
    let some_string = String::from("yours");

    some_string // some_string å †ä¸­éƒ¨åˆ†çš„æ‰€æœ‰æƒå°†è¢«äº¤ç»™è°ƒç”¨å®ƒçš„å˜é‡
}

fn takes_and_gives_back(a_string: String) -> String { 
    a_string
}
```

æ‰€æœ‰å˜é‡çš„æ‰€æœ‰æƒéƒ½éµå¾ªç›¸åŒçš„ç¨‹å¼ï¼šæŠŠå€¼ç›´æ¥èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ä¼šäº§ç”Ÿç§»åŠ¨ï¼ˆmoveï¼‰ã€‚å½“åŒ…å«äº†å †æ•°æ®çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼å°†é€šè¿‡ `drop()` æ¸…é™¤ï¼Œé™¤éè¯¥æ•°æ®çš„æ‰€æœ‰æƒå·²ç»å½’å¦ä¸€ä¸ªå˜é‡æ‰€æœ‰ã€‚

æµ‹è¯•ä¸‹é¢çš„ä¸€æ®µä»£ç ï¼š

```rust
fn main() {
    let s = String::from("hello");
    
    takes_ownership(s);
    
    println!("{}", s.len())
}

fn takes_ownership(s: String) {
    println!("{}", s.len());
}
```

æ„æ–™ä¹‹ä¸­åœ°å‘ç”Ÿäº†ç¼–è¯‘é”™è¯¯ï¼Œé‚£ä¹ˆå¦‚ä½•é‡æ–°å–å¾—ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰æƒå‘¢ï¼Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è§£å†³ï¼š

```rust
fn main() {
    let s1 = String::from("hello");

    let (s1, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: String) -> (String, usize) {
    let length = s.len();

    (s, length)
}
```

ä¸Šé¢çš„ä»£ç å€Ÿ Tuple å®ç°äº†å¤šè¿”å›å€¼ï¼Œå¹¶ä½¿ç”¨äº† Rust çš„ *shadowing* æœºåˆ¶é‡æ–°å¾—åˆ°äº†æ‰€æœ‰æƒå¹¶äº¤ç»™äº†åŒåå˜é‡ `s1`ï¼Œå¯ä»¥æ„Ÿè§‰åˆ°è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¤ªéº»çƒ¦äº†ã€‚å¹¸è¿çš„æ˜¯ï¼ŒRust æä¾›äº†**å¼•ç”¨**ï¼ˆ*references*ï¼‰æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

#### æ€»ç»“

æœ¬èŠ‚å¯¹äº Rust çš„æ‰€æœ‰æƒæœºåˆ¶è¿›è¡Œäº†ä¸€ä¸ªåˆæ­¥çš„ä»‹ç»ï¼ŒRust ç”¨æ‰€æœ‰æƒæœºåˆ¶è®©æ ˆä¸­çš„å˜é‡ä¸å…¶åœ¨å †ä¸­åˆ†é…çš„æ•°æ®ä¸€å¯¹ä¸€åœ°å…³è”èµ·æ¥ï¼ˆä¸ªäººæ„Ÿè§‰è¿™å°±åƒä¸€æ¡ç‰µç‹—ç»³ï¼‰ï¼Œåœ¨å˜é‡èµ‹å€¼çš„è¿‡ç¨‹ä¸­ï¼ŒåŸå˜é‡ä¼šå¤±å»å †ä¸­æ•°æ®çš„æ‰€æœ‰æƒï¼Œè½¬äº¤ç»™è¢«èµ‹å€¼çš„å˜é‡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒRust ç¡¬æ€§åœ°è§£å†³äº†å¸¸è§çš„å„ç§å†…å­˜åˆ†é…é—®é¢˜ã€‚ç”±äºæ‰€æœ‰æƒçš„å”¯ä¸€åŒ–ï¼Œåœ¨å˜é‡ä½œç”¨åŸŸç»“æŸæ—¶å°±å¯ä»¥å°†å…¶è‡ªåŠ¨å›æ”¶ï¼Œä¸ä¼šå‡ºç°å¿˜è®°å›æ”¶ä»¥åŠé‡å¤å›æ”¶çš„é—®é¢˜ã€‚

### å¼•ç”¨å’Œå€Ÿç”¨

ä¸Šä¸€èŠ‚æœ«å°¾æåˆ°çš„**å¼•ç”¨**ï¼ˆ*references*ï¼‰æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸ç§»åŠ¨æ‰€æœ‰æƒçš„å‰æä¸‹è®¿é—®ä¸€ä¸ªå˜é‡çš„å †ä¸­æ•°æ®ã€‚ä¸‹é¢æ˜¯ç”±ä¸Šä¸€èŠ‚æœ«å°¾å¤„ä»£ç æ”¹å†™çš„ä¸€ä¸ªç¤ºä¾‹ï¼š

```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
}
```

æ³¨æ„è¿™æ®µä»£ç ä¸­çš„æ–°è¯­æ³• `&`ï¼ˆ`&s1` å’Œ `&String`ï¼‰ï¼Œä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦èƒ½å¤Ÿå¼•ç”¨ä¸€ä¸ªå˜é‡ï¼Œä»è€Œåœ¨æ²¡æœ‰æ‰€æœ‰æƒçš„æƒ…å†µä¸‹æ“ä½œè¿™ä¸ªå˜é‡çš„å †ä¸­æ•°æ®ã€‚å…¶åº•å±‚çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![&String s pointing at String s1](Learning-Rust/trpl04-05.svg)

> æ³¨æ„ï¼šä½¿ç”¨ `&` è¿›è¡Œå¼•ç”¨çš„ç›¸åæ“ä½œæ˜¯å–æ¶ˆå¼•ç”¨ï¼Œå¯ä»¥é€šè¿‡å–æ¶ˆå¼•ç”¨æ“ä½œç¬¦ `*` æ¥å®Œæˆï¼Œè¿™äº›å†…å®¹æš‚æ—¶ä¸è¿›è¡Œè®¨è®ºã€‚

ä¸Šè¿°ä»£ç ä¸­ï¼Œ`calculate_length` å‡½æ•°ä¸­çš„ `s` æ˜¯ä¸€ä¸ª `&String` ç±»å‹ï¼Œå³ä¸€ä¸ª `String` çš„å¼•ç”¨ç±»å‹ï¼Œè¿™è¡¨æ˜å®ƒä¸å…·æœ‰æŸä¸ªå€¼çš„æ‰€æœ‰æƒï¼Œåœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¸ä¼šå¯¹å…¶è°ƒç”¨ `drop()` æ“ä½œï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°ä¹Ÿä¸éœ€è¦å½’è¿˜ä»»ä½•å€¼çš„æ‰€æœ‰æƒã€‚

æˆ‘ä»¬æŠŠåˆ›å»ºå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º**å€Ÿç”¨**ï¼ˆ*borrowing*ï¼‰ï¼Œè¿™ä¸ªåå­—åŒ…å«äº†â€œæœ‰å€Ÿæœ‰è¿˜â€çš„åŸåˆ™ã€‚

çœ‹åˆ°è¿™é‡Œå¾ˆè‡ªç„¶åœ°ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬èƒ½ä¸èƒ½å¯¹â€œå€Ÿâ€æ¥çš„å€¼è¿›è¡Œå†™æ“ä½œå‘¢ï¼Ÿå°è¯•ç¼–è¯‘è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š

```rust
fn main() {
    let s = String::from("hello");

    change(&s);
}

fn change(some_string: &String) {
    some_string.push_str(", world");
}
```

```shell
$ cargo run
   Compiling ownership v0.1.0
error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference
  --> src\main.rs:42:5
   |
41 | fn change(some_string: &String) {
   |                        ------- help: consider changing this to be a mutable reference: `&mut String`
42 |     some_string.push_str(", world");
   |     ^^^^^^^^^^^ `some_string` is a `&` reference, so the data it refers to cannot be borrowed as mutable

For more information about this error, try `rustc --explain E0596`.
error: could not compile `ownership` due to previous error
```

ç­”æ¡ˆæ˜¯ä¸èƒ½ï¼Œä»ç¼–è¯‘é”™è¯¯çš„ä¿¡æ¯ä¸­æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ï¼Œç”± `&` å€Ÿç”¨æ¥çš„ `String` å¼•ç”¨ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚

#### å¯å˜å¼•ç”¨

æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼è§£å†³å¼•ç”¨ä¸å¯å˜çš„é—®é¢˜ï¼š

```rust
fn main() {
    let mut s = String::from("hello"); // mut

    change(&mut s); // mut
}

fn change(some_string: &mut String) { // mut
    some_string.push_str(", world");
}
```

ä¸Šé¢çš„ä»£ç æˆåŠŸç¼–è¯‘å¹¶è¿è¡Œäº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ‰€æœ‰æƒçš„æ‹¥æœ‰è€…ï¼ˆ`s`ï¼‰åŒæ ·ä¹Ÿè¦è¢«æ”¹ä¸ºå¯å˜çš„ã€‚

ç„¶è€Œæœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜æ˜¯åªèƒ½å€Ÿç”¨ä¸€æ¬¡å¯å˜ï¼Œä¸‹é¢çš„ä»£ç å°±ä¼šç¼–è¯‘å‡ºé”™ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &mut s;
    let r2 = &mut s;

    println!("{}, {}", r1, r2);
}
```

ä¸èƒ½å¤šæ¬¡å€Ÿç”¨ `s` ä½œä¸ºå¯å˜å‚æ•°ã€‚å¯èƒ½æœ‰äººä¼šæƒ³ï¼ˆæ¯”å¦‚æˆ‘å°±è¿™ä¹ˆæƒ³ï¼‰ï¼šæ—¢ç„¶ä¸èƒ½è¿›è¡Œå¤šæ¬¡å¯å˜å€Ÿç”¨ï¼Œé‚£å¤šæ¬¡ä¸å¯å˜å€Ÿç”¨è¡Œä¸è¡Œï¼Ÿ

```rust
fn main() {
    let mut s = String::from("hello"); // ç”±äº mut å±æ€§æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œç¼–è¯‘æ—¶ä¼šè­¦å‘Šä½†ä¸ä¼šæŠ¥é”™

    let r1 = &s;
    let r2 = &s;

    println!("{}, {}", r1, r2);
}
```

è¿™ä¹ˆå†™å°±å¯ä»¥äº†ï¼Œä½†è¦æ˜¯ä¸€ä¸ªå¯å˜å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜å€Ÿç”¨å‘¢ï¼Ÿå°è¯•ä¸‹é¢çš„æƒ…å†µï¼š

```rust
let r1 = &mut s;
let r2 = &s;
```

è¿™æ¬¡ç¼–è¯‘æŠ¥é”™ï¼Œæç¤º ``cannot borrow `s` as immutable because it is also borrowed as mutable``ï¼Œæ„æ€æ˜¯å·²ç»ä»¥å¯å˜çš„æ–¹å¼å€Ÿç”¨è¿‡äº†ï¼Œä¸èƒ½å†ä»¥ä¸å¯å˜çš„æ–¹å¼å€Ÿç”¨äº†ã€‚å†ç»™å®ƒé¢ å€’è¿‡æ¥è¯•ä¸€ä¸‹ï¼š

```rust
let r1 = &s;
let r2 = &mut s;
```

è¿™æ¬¡ä»ç„¶æŠ¥é”™ï¼Œæç¤º ``cannot borrow `s` as mutable because it is also borrowed as immutable``ï¼ŒåŒæ ·ä¸è¡Œï¼ŒæŠ¥é”™ä¿¡æ¯ä¹Ÿåè¿‡æ¥äº†ã€‚

ç¬¬ä¸€ä¸ªå¯å˜å€Ÿç”¨åœ¨ `r1` ä¸­å¹¶ä¸”å¿…é¡»æŒç»­åˆ°å®ƒåœ¨ `println!` ä¸­ä½¿ç”¨ä¸ºæ­¢ï¼Œè¦æƒ³å†å€Ÿç”¨å°±å¿…é¡»åœ¨è¿™ä¹‹åï¼ˆæ— è®ºæ˜¯å¯å˜è¿˜æ˜¯ä¸å¯å˜ï¼‰ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç æ˜¯æœ‰æ•ˆçš„ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &mut s;
    println!("{}", r1);
    
    let r2 = &mut s;
    println!("{}", r2);
}
```

ç»¼ä¸Šæ‰€è¿°ï¼Œé˜²æ­¢å¯¹åŒä¸€æ•°æ®è¿›è¡Œå¤šä¸ªå¯å˜å¼•ç”¨çš„é™åˆ¶å¾ˆä¸¥æ ¼ï¼Œä»è€Œéå¸¸å®‰å…¨å¯æ§ã€‚ä¸è¿‡è™½ç„¶å¯ä»¥é€šè¿‡ä¸Šé¢çš„ä»£ç æ¥å®ç°å€¼çš„å˜åŠ¨ï¼Œä½†è¿™å®åœ¨æ˜¯æœ‰äº›éº»çƒ¦ã€‚

> è¿™ä¹Ÿæ˜¯å¾ˆå¤šæ–°çš„ Rust äººå£«ï¼ˆRustaceansï¼ŒRust å¼€å‘è€…çš„è‡ªç§°ï¼‰æƒ³è¦åŠªåŠ›è§£å†³çš„é—®é¢˜ï¼Œå› ä¸ºå¤§å¤šæ•°è¯­è¨€éƒ½å¯ä»¥è®©å¼€å‘è€…éšæ—¶è¿›è¡Œå˜åŠ¨ã€‚

æœ‰è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶é˜²æ­¢å‡ºç°**æ•°æ®ç«äº‰**ï¼ˆ*data races*ï¼‰ã€‚æ•°æ®ç«äº‰ç±»ä¼¼äºç«äº‰æ¡ä»¶ï¼ˆ*race condition*ï¼‰ï¼Œå½“å‡ºç°ä»¥ä¸‹ä¸‰ç§è¡Œä¸ºæ—¶å°±ä¼šå‘ç”Ÿï¼š

- ä¸¤ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆåŒæ—¶è®¿é—®ç›¸åŒçš„æ•°æ®ï¼›
- è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆç”¨äºå†™å…¥æ•°æ®ï¼›
- æ²¡æœ‰ç”¨äºåŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚

æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºï¼Œå¹¶ä¸”å½“ä½ å°è¯•åœ¨è¿è¡Œæ—¶è¿½è¸ªå®ƒä»¬ï¼Œå¯èƒ½éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ã€‚Rust é˜²æ­¢äº†è¿™ä¸ªé—®é¢˜çš„å‘ç”Ÿï¼Œå› ä¸ºå¸¦æœ‰æ•°æ®ç«äº‰çš„ä»£ç ç¼–è¯‘ç›´æ¥ä¸èƒ½é€šè¿‡ã€‚
